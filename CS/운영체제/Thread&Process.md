## 프로세스 (process)

> 단순히 실행 중인 프로그램을 말한다.

- 즉, 사용자가 작성한 프로그램이 운영체제에 의해 메모리 공간을 할당받아 실행중인 것을 말한다.
- 프로세스는 프로그램에 사용되는 데이터와 메모리 등의 자원, 스레드로 구성된다.
- 하나의 프로세스를 구성하는 스레드들은 프로세스에 할당된 메모리, 자원 등을 공유한다.
    - 각각의 스레드는 독립적인 작업을 수행해야 하기 때문에 각자 스택과 PC 레지스터 값을 가지고 있다.

### 스택을 스레드마다 독립적으로 할당하는 이유
        
> 스택은 `함수 호출 시 전달되는 인자`, `되돌아갈 주소값`, `함수 내에서 선언하는 변수` 등을 저장하기 위해 사용되는 메모리 공간이다.

- 스택 메모리 공간이 독립적이라는 것은 독립적인 함수 호출이 가능하다는 것이고, 이는 독립적인 실행 흐름이 가능하게 한다.  
→ 따라서 독립적인 실행 흐름을 위한 최소 조건으로 독립적인 스택을 할당한다.
        
### PC 레지스터를 스레드마다 독립적으로 할당하는 이유

> PC 값은 스레드가 명령어의 어디까지 수행하였는지를 나타낸다.      

- 스레드는 CPU를 할당받았다가 스케쥴러에 의해 다시 섬정당한다.
- 그렇기 때문에 명령어가 연속적으로 수행되지 못하고, 어느 부분까지 수행했는지 기억할 필요가 있다.
→ 따라서 PC 레지스터를 독립적으로 할당한다.


## 스레드 (thread)

> 프로세스 내에서 실제로 작업을 수행하는 주체를 의미한다. (= 프로그램 실행의 단위)

- 모든 프로세스에는 한 개 이상의 스레드가 존재하여 작업을 수행한다.
- 또한, 두 개 이상의 스레드를 가지는 프로세스를 `멀티스레드 프로세스`  라고 한다.

![what_is_thread_1](https://user-images.githubusercontent.com/59866819/154971501-e7be4cce-5339-40ee-886a-7c770f51bf54.png)

### 스레드의 장점
    - 프로세스보다 생성 및 종료 시간, 스레드간 전환 시간이 짧다.
    - 프로세스의 메모리, 자원 등을 공유하므로 커널의 도움없이 상호간에 통신이 가능하다.

### 스레드 동기화 방법의 종류
> Mutex / Semaphore / Monitor 가 있다.
셋의 공통점은 모두 운영체제의 동기화 기법이라는 것이다.

### 1) Mutual Exclusion (뮤텍스)

> ‘상호배제’ 라고도 한다. 임계영역을 가진 스레드들의 러닝타임이 겹치지 않게 각각 단독으로 실행되기 하는 기술이다.  
> 다중 프로세스들의 공유 리소스 접근을 조율하기 위해 locking, unlocking을 사용한다.  
> 
→ 뮤텍스 객체를 두 스레드가 동시에 사용할 수 없다는 의미이다.

- 스레드의 동시 접근을 서용하지 않겠다는 의미이다.
- 임계 영역에 들어가기 위해서는 뮤텍스를 가지고 있어야 들어갈 수 있다.

→ 임계영역에 들어간 스레드가 뮤텍스를 이용해 임계영역에서 본인이 나올 때까지 다른 스레드가 들어오지 못하게 내부에서 자물쇠로 잠근다.

    ** 임계영역(Critial Section)이란?

    - 다중 프로그래밍 운영체제에서 여러 프로세스가 데이터를 공유하면서 수행될 때  
      각 프로세스에서 공유 데이터를 접근하는 프로그램 코드 부분을 가리키는 말이다.  

→ 같은 부분에 여러 프로세스가 동시에 접근하면 시간 차이 등으로 인해 문제가 발생할 수 있다. 
그러므로 공유 데이터에 접근할 때,
다른 프로세스들은 절대로 그 데이터에 접근하지 못하도록 해야한다.
    

### 2) Semaphore (세마포어)
> 멀티 프로그래밍 환경에서 공유된 자원에 대한 접근을 제한하는 방법이다.  
> 사용하고 있는 스레드/프로세스의 수를 공통으로 관리하는 하나의 값을 이용해 상호배제를 달성한다.  
> 공유 자원에 접근할 수 있는 프로세스의 최대 허용치만큼 동시에 사용자가 접근할 수 있다.  
> 

- 리소스의 상태를 나타내는 간단한 카운터라고 생각할 수 있다.  
- 세마포어는 운영체제/커널의 한 지정된 저장장치 내의 값으로, 각 프로세스는 이를 확인하고 변경할 수 있다.  
- 확인되는 세마포어의 값에 따라, 그 프로세스가 즉시 자원을 사용할 수 있거나, 또는 이미 다른 프로세스에 의해 사용중이라는 사실을 알게 되면 재시도를 하기 전 일정 시간을 기다려야 한다.  
- 세마포어는 이진수를 사용하거나 추가적인 값을 가질 수도 있다.
 
→ 세마포어를 사용하는 프로세스는 그 값을 확인하고, 자원을 사용하는 동안에는 그 값을 변경함으로써 다른 세마포어 사용자들이 기다리도록 해야한다.

- 뮤텍스와 비슷한 역할 BUT, 동시 접근 동기화가 아닌, 접근 순서 동기화에 더 가깝다.
- 일반적으로 비교적 긴 시간을 확보하는 리소스에 대해 이용하게 되며, 운영체제 리소스를 경적으로 사용하는 다중 프로세스에서 행동을 조정하거나 동기화 시키는 기술이다.

### Mutex / Semaphore 둘의 차이는?

- 가장 큰 차이점은 관리하는 동기화 대상의 갯수이다.

      - 뮤텍스: 하나의 프로세스/스레드가 접근하는 것을 막아준다 → 동기화 대상이 하나
      - 세마포어: 여러 프로세스/스레드가 접근하는 것을 막아준다 → 동기화 대상이 하나 이상

- 세마포어는 뮤텍스가 될 수 있지만, 뮤텍스는 세마포어가 될 수 없다.
→ 왜냐면 뮤텍스는 상태가 0, 1 두개 뿐인 binary semaphore 이기때문이다.
- 세마포어는 소유할 수 없고, 뮤텍스는 소유 가능하다.

      - 뮤텍스는 소유주가 이에 대한 책임을 진다. (상태가 두개 뿐이므로 lock을 가질 수 있음)

- 뮤텍스: 뮤텍스를 소유하고 있는 스레드가 이 뮤텍스를 해제할 수 있다.
→ 세마포어: 세마포어를 소유하지 않는 스레드가 세마포어를 해제할 수 있다.
- 세마포어: 시스템 범위에 걸쳐있고 파일 시스템 상의 파일 형태로 존재한다.
→ 뮤텍스: 프로세스 범위를 가지며 프로세스가 종료될 때 자동으로 clean up 된다.
