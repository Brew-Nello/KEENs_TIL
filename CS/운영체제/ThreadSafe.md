# Thread-Safe

## Thread-safe 란?
멀티 스레드 프로그래밍에서 일반적으로  
어떤 함수나 변수, 객체가 여러 스레드로부터 동시에 접근이 이루어져도 프로그램의 실행에 문제가 없음을 말한다.


보다 엄밀하게는 
```
하나의 함수가 한 스레드로부터 호출되어 실행중일 때,  
다른 스레드가 그 함수를 호출하여 동시에 함께 실행되더라도 각 스레드에서의 함수의 수행 결과가 올바로 나오는 것을 말한다.
```

## Thread-safe 를 지키는 방법은?

- `Re-entrancy`  
  - 어떤 함수가 한 스레드에 의해 호출되어 실행 중일 때, 다른 스레드가 그 함수를 호출하더라도 그 결과가 각각에게 올바르게 주어져야 한다.

- `Thread-local storage`  
  - 공유 자원의 사용을 최대한 줄여 각각의 스레드에서만 접근 가능한 저자소들을 사용함으로써 동시 접근을 막는다.
  - 이 방식은 동기화 방법과 관련되어 있고, 또한 공유 상태를 피할 수 없을 때 사용하는 방식이다.

- `Mutual exclusion`  
  - 공유 자원을 꼭 사용해야 할 경우 해당 자원의 접근을 세마포어 등의 락으로 통제한다.

  - 상호 배제란? : 한 thread가 자원에 접근할 떄 다른 thread의 접근을 막는 것을 의미한다.

- `Atomic operatoins`  
  - 공유 자원에 접근할 떄 원자 연산을 이용하거나 '원자적'으로 정의 된 접근 방법을 사용함으로써 상호 배제(Mutual Exclusion)를 구현할 수 있다.
  - 통상적으로 Criticial Section 처리가 자주 사용되는 편이다.

## Atomic? Non-Atomic?
> atomic   
> : 프로그래밍에서 데이터의 변경이 동시에 일어난 것처럼 보이게 하는 것을 의미한다.

- 데이터의 값을 변경하는 것은 항상 그 시간이 필요하다.
- `atomic`한 데이터의 변경이 이루어지는 시간에는 `lock` 을 걸어 데이터를 변경하는 시간동안에는 접근이 이루어지지 않게 한다.

```
그래서 프로퍼티가 `atomic 하다`는 것은 멀티 스레드 환경에서 데이터가 반드시 변경전과 후의 상황에서만 접근하는 것을 보장함. 
즉, 데이터의 변경이 이루어지고 있는 순간에는 접근이 불가능!

atomic property 는 항상 serial 하게 접근됨.
```
> non-atomic   
> : 반환된 값에 대해 보장하지 않는다. 그렇기에 정확한 값일 수도, 쓰레기 값일 수도 있다.

### Swift의 경우
- `Thread-safe`를 고려한 언어가 아니기 때문에 모든 프로퍼티는 `non-atomic` 이다.
- 따라서 별도 `atomic`을 지정하는 것이 불가능 -> 그렇기 떄문에 GCD(Grand-Central-Dispatch) 를 통해 다뤄야 한다.



